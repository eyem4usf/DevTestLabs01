{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "VMSize": {
      "type": "string",
      "defaultValue": "Standard_D1",
      "metadata": {
        "description": "Size of VMs in the VM Scale Set."
      }
    },
    "VMName": {
      "type": "string",
      "metadata": {
        "description": "String used as a base for naming resources (9 characters or less). A hash is prepended to this string for some resources, and resource-specific information is appended."
      },
      "maxLength": 9
    },
    "adminUsername": {
      "type": "string",
      "metadata": {
        "description": "Admin username on all VMs."
      }
    },
    "adminPassword": {
      "type": "securestring",
      "metadata": {
        "description": "Admin password on all VMs."
      }
    },
    "virtualNetworkName": {
      "type": "string",
      "metadata": {
        "description":"Name of existing vnet that you want these resources to use"
      }
    },
      "virtualnetworkResourceGroup": {
        "type": "string",
        "metadata": {
          "description":"Name of resource group that contains the virtual network you want to use"
        }
      },
      "SubnetName": {
      "type": "string",
      "metadata": {
        "description":"Name of existing Web/App subnet that you want these resources to use"
      }
      }
    

    
  },
  "variables": {
    "location": "[resourceGroup().location]",
    "vnetID" : "[resourceId(parameters('virtualnetworkResourceGroup'),'Microsoft.Networks/virtualNetworks', parameters('virtualNetworkName'))]", 
    "SubnetID" : "[concat(variables('vnetID'),'/subnets/', parameters('SubnetName'))]" ,
    "MasternetworkInterfaceName": "[concat(parameters('VMName'),'nic')]"  
    
  },
  "resources": [
  
 

 
        {
            "name": "[variables('MasternetworkInterfaceName')]",
            "type": "Microsoft.Network/networkInterfaces",
            "apiVersion": "2016-09-01",
            "location": "[variables('location')]",
            "dependsOn": [
                             
            ],
            "properties": {
                "ipConfigurations": [
                    {
                        "name": "ipconfig1",
                        "properties": {
                            "subnet": {
                                "id": "[variables('SubnetID')]"
                            },
                            "privateIPAllocationMethod": "Dynamic"
                           
                        }
                    }
                ]
            }
        },
       
       
       
        {
            "name": "[parameters('VMName')]",
            "type": "Microsoft.Compute/virtualMachines",
            "apiVersion": "2016-04-30-preview",
            "location": "[variables('location')]",
            "dependsOn": [
                "[concat('Microsoft.Network/networkInterfaces/', variables('MasternetworkInterfaceName'))]"
               
            ],
            "properties": {
                "osProfile": {
                    "computerName": "[parameters('VMName')]",
                    "adminUsername": "[parameters('adminUsername')]",
                    "adminPassword": "[parameters('adminPassword')]",
                    "windowsConfiguration": {
                        "provisionVmAgent": "true"
                    }
                },
                "hardwareProfile": {
                    "vmSize": "[parameters('VMSize')]"
                },
                "storageProfile": {
                    "imageReference": {
                        "id": "/subscriptions/61f3232b-7b0a-4c0c-b558-b241ec754ca4/resourceGroups/DTLmanagedImageARMtestRG/providers/Microsoft.Compute/images/DTLtestImage01-image-20170420092807"
                    }
                },
                "networkProfile": {
                    "networkInterfaces": [
                        {
                            "id": "[resourceId('Microsoft.Network/networkInterfaces', variables('MasternetworkInterfaceName'))]"
                        }
                    ]
                }
            }
        }
        


        

  ]
}
